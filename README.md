# LiveStories data pipeline 

### Project
Create a data pipeline between LiveStories' S3 tsv source data and a developed data science/analytics infrastructure.  

### Current problem 
Currently LiveStories data is only available for internal use in tsv format or via API, both of which are not optimal for running data science queries on this ~100GB dataset.  

### Project outline
Calculate the similarity metrics for all indicators in the original dataset and return all calculated results to the original data store for use by LiveStories' front end API. 

### Architecture
![alt text](https://github.com/allsway/ls-data-pipeline/imgs/livestories_pipeline (2).jpg)

### Running spark job
`./batch_process.sh`

### Dependencies
All python modules included in grab_data.py.  The postgresql-42.0.0.jre6.jar should be included in the --jars flag when running the spark-submit job, as shown in batch_process.sh

### Metric example

```
"locale","comp_locale","adjusted_correlation","weighted_distance","indicator_id","compared_intervals"
"US:ST:CA","US:ST:MD",0.982605623702208,5.08071004118229,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:MI",1.18529619276524,4.17383222546908,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:NY",0.936637648769343,3.18797299422305,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:IA",1.18308153251807,3.06798401752301,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:PA",0.968993245158344,3.02921864104003,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:WI",0.986073305713944,2.44253650691288,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:ME",1.09316957741976,2.31287346437844,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:CT",1.05921693891287,2.29903292468739,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:NM",0.929819564024607,2.24442471869368,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:KS",0.879610440693795,2.11997239425932,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:MN",0.916716878612836,2.02979817611645,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:VT",1.07518965750933,1.9836620851379,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:TN",1.13603997975588,1.8215374527024,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2004}"
"US:ST:CA","US:ST:KY",0.959165426592032,1.48790143759594,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:NH",1.11878470579783,1.4786885006639,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2004}"
"US:ST:CA","US:ST:NC",1.15585243081053,1.43840665175545,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2003,Y1:2010,Y1:2004}"
"US:ST:CA","US:ST:UT",1.15058720111847,1.4035934022957,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:SC",0.986380624274412,1.21198597521403,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:FL",1.02327901000778,0.979556398461373,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:LA",0.995351605117321,0.973518209623236,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:WA",0.967254805068174,0.920777545395267,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:MA",1.0419255917271,0.899531127477868,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:OR",0.971166372299194,0.89247742872837,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:NJ",0.882859696944554,0.836032516087731,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
"US:ST:CA","US:ST:AZ",1.05602136502663,0.799792084158299,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2009,Y1:2011,Y1:2010,Y1:2012}"
"US:ST:CA","US:ST:CA",0.5,0.0,"US.GOV.CDC.NEPH.EPHTRACKINGNET.CARBONMONOXIDEPOISONING:HSPRATE","{Y1:2008,Y1:2006,Y1:2007,Y1:2005,Y1:2013,Y1:2002,Y1:2001,Y1:2000,Y1:2009,Y1:2011,Y1:2003,Y1:2010,Y1:2012,Y1:2004}"
```
